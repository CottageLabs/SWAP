{% extends "leaps/admin/admin-base.html" %}

{% block content %}

<script type="text/javascript">
jQuery(document).ready(function($) {

    var optsets = {
        "school": {
            search_url: '/query/school?',
            datatype: 'JSON',
            resdisplay: [
                [
                    {
                        "pre": '',
                        "field": "id",
                        "post": ""
                    }
                ]
            ],
            facets: []
        }
    };
    optsets.institution = optsets.school;
    optsets.level = optsets.school;
    optsets.advancedlevel = optsets.school;
    optsets.subject = optsets.school;
    optsets.grade = optsets.school;
    optsets.year = optsets.school;
    optsets.simd = optsets.school;

    var opts = {
        search_url: optsets.school.search_url,
        datatype: optsets.school.datatype,
        facets: optsets.school.facets,
        searchbox_shade: "#fff",
        result_display: optsets.school.resdisplay,
        sharesave_link: false,
        paging: {
            size: 50
        }
    };
    $('#facetview').facetview(opts);

    var searchtype = function(event) {
        event ? event.preventDefault() : false;
        $('.searchtype').removeClass('btn-success');
        $(this).addClass('btn-success');
        var type = $(this).attr('data-type');
        opts.search_url = optsets[type]['search_url'];
        opts.datatype = optsets[type]['datatype'];
        opts.facets = optsets[type]['facets'];
        opts.result_display = optsets[type]['resdisplay'];
        var p = $('#facetview').parent();
        $('#facetview').remove();
        p.append('<div id="facetview"></div>');
        $('#facetview').facetview(opts);
        $('#newtype').text(type);
    }
    $('.searchtype').bind('click',searchtype);
    
    var addnew = function(event) {
        event.preventDefault();
        var newtype = $('#newtype').text();
        window.location = '/admin/data/' + newtype + '/new';
    }
    $('.addnew').bind('click',addnew);
});

</script>



<div class="row-fluid" style="margin-bottom:10px;">
    <div class="span12">
        <h1>Manage supporting data</h1>
    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <p>
            <a class="btn btn-success searchtype" data-type="school" href="#">Schools</a>
            <a class="btn searchtype" data-type="institution" href="#">Institutions</a>
            <a class="btn searchtype" data-type="level" href="#">School study levels</a>
            <a class="btn searchtype" data-type="advancedlevel" href="#">Advanced study levels</a>
            <a class="btn searchtype" data-type="subject" href="#">Subjects</a>
            <a class="btn searchtype" data-type="grade" href="#">Grades</a>
            <a class="btn searchtype" data-type="year" href="#">Year groups</a>
            <a class="btn searchtype" data-type="simd" href="#">SIMD</a>
            <a class="btn btn-info addnew" href="#">add new <span id="newtype">school</span></a>
        </p>
    </div>
</div>

<div class="row-fluid">
    <div class="span12">
        <div id="facetview"></div>
    </div>
</div>


{% endblock %}
